# ============================================================================
# PLOS Prometheus Configuration
# Production-ready metrics collection for all microservices
# ============================================================================

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: 'plos-production'
    environment: 'production'

# Alertmanager configuration (configure when alertmanager is deployed)
alerting:
  alertmanagers:
    - static_configs:
        - targets: []

# Scrape configurations for active services only
scrape_configs:
  # ========================================================================
  # PROMETHEUS SELF-MONITORING
  # ========================================================================
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
    metrics_path: '/metrics'

  # ========================================================================
  # CORE PLOS SERVICES
  # ========================================================================

  # Context Broker - Central state management
  - job_name: 'context-broker'
    static_configs:
      - targets: ['context-broker:8001']
    metrics_path: '/metrics'
    scrape_interval: 10s

  # Journal Parser - AI-powered extraction
  - job_name: 'journal-parser'
    static_configs:
      - targets: ['journal-parser:8002']
    metrics_path: '/journal/metrics'
    scrape_interval: 10s

  # Knowledge System - Vector search and semantic indexing
  - job_name: 'knowledge-system'
    static_configs:
      - targets: ['knowledge-system:8003']
    metrics_path: '/metrics'
    scrape_interval: 10s

  # ========================================================================
  # INFRASTRUCTURE MONITORING
  # ========================================================================

  # PostgreSQL (via postgres_exporter if deployed)
  # Uncomment when postgres_exporter is added
  # - job_name: 'postgres'
  #   static_configs:
  #     - targets: ['postgres-exporter:9187']
  #   metrics_path: '/metrics'

  # Redis (via redis_exporter if deployed)
  # Uncomment when redis_exporter is added
  # - job_name: 'redis'
  #   static_configs:
  #     - targets: ['redis-exporter:9121']
  #   metrics_path: '/metrics'

  # Kafka (via kafka_exporter if deployed)
  # Uncomment when kafka_exporter is added
  # - job_name: 'kafka'
  #   static_configs:
  #     - targets: ['kafka-exporter:9308']
  #   metrics_path: '/metrics'

  # Qdrant Vector DB (telemetry endpoint)
  # Note: Qdrant requires api-key header for authentication
  - job_name: 'qdrant'
    static_configs:
      - targets: ['qdrant:6333']
    metrics_path: '/telemetry'
    scrape_interval: 30s
    params:
      format: ['prometheus']
    # Qdrant uses custom header, so we disable scraping until
    # a dedicated exporter is deployed or auth is disabled in dev
    # authorization:
    #   type: Bearer
    #   credentials: qdrant_secure_key_2025

# ============================================================================
# RECORDING RULES (for pre-computed metrics)
# ============================================================================
# rule_files:
#   - '/etc/prometheus/rules/*.yml'
